<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <title>Last Week: Reddit</title>

    <!-- Bootstrap -->
    <link href="static/css/bootstrap.min.css" rel="stylesheet">
    <link href="static/css/lwr.css" rel="stylesheet">

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->

    <!-- Javascript to expand thanks to Diego F. -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
    <script type="text/javascript">
    	$(document).ready(function(e) {
    		$("a.expand").click(function(e){
          var excerpt = $(e.target).parents(".item").find("p.excerpt");
          var link = $(e.target);
          if (excerpt.hasClass("truncate")) {
            excerpt.removeClass("truncate");
            link.html("Close")
          }
          else {
            excerpt.addClass("truncate");
            link.html("Expand")
          }
    		});
    	});
    </script>
  </head>
  <div class="container">
	<h1>Top Submissions in r/{{subreddit}}</h1>
		{% for group in submissions|batch(3) %}
		<div class="row submissions">
			{% for submission in group %}
				<div class="col-md-4 item {% if submission.gilded == 1 %}gold{% endif %} submission">
          <div class="top-box text-right"><a class="read-more" target="_blank" href="{{submission.url}}"></a>Submission</div>
					<h3 class="title">{{submission.title}}</h3>
					<h4>{{submission.score}} points <small>by {{submission.author }}</small></h4>
					<p>Comments: {{submission.comments}}</p>
				</div>
			{% endfor %}
		</div>
		{% endfor %}
  </div>
  <div class="container">
	<h1>Top Comments in r/{{subreddit}}</h1>
	{% for group in comments|batch(3) %}
	<div class="row comments">
		{% for comment in group %}
			{# Todo: Get Submission Name from Submission ID here #}
			<div class="col-md-4 item {% if comment.gilded == 1 %}gold{% endif %} comment">
        <div class="top-box text-right"><a class="read-more" target="_blank" href="{{comment.url}}?context=3"></a>Comment</div>
				<h3>{{comment.author}} <small>({{comment.score}})</small></h3>
        <h4><small class="excerpt truncate">in {{comment.stitle}}</small></h4>
				<p class="excerpt truncate">{{comment.body}}</p>
        <p>Replies: {{comment.replies}}</p>
				<a class="expand">Expand</a>
			</div>
		{% endfor %}
	</div>
  	{% endfor %}
  </div>
</html>